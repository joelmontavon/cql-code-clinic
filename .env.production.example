# Production Environment Configuration
# Copy this file to .env.production and fill in your actual values

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================
NODE_ENV=production
APP_NAME=CQL Code Clinic
APP_VERSION=1.0.0
APP_DESCRIPTION=Interactive CQL Learning Platform

# =============================================================================
# DOMAIN AND URL CONFIGURATION
# =============================================================================
# Main application domain
DOMAIN=cqlclinic.com
FRONTEND_DOMAIN=cqlclinic.com
API_DOMAIN=api.cqlclinic.com

# Application URLs
FRONTEND_URL=https://cqlclinic.com
BACKEND_URL=https://api.cqlclinic.com

# CORS allowed origins (comma-separated)
ALLOWED_ORIGINS=https://cqlclinic.com,https://www.cqlclinic.com

# =============================================================================
# SERVICE PORTS
# =============================================================================
FRONTEND_PORT=3000
BACKEND_PORT=3001
CQL_RUNNER_PORT=8080
POSTGRES_PORT=5432
REDIS_PORT=6379

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL Settings
POSTGRES_DB=cql_clinic_prod
POSTGRES_USER=cql_user
POSTGRES_PASSWORD=CHANGE_THIS_STRONG_PASSWORD
POSTGRES_HOST=postgres
POSTGRES_SSL=true

# Database URL (constructed from above or override with full URL)
DATABASE_URL=postgresql://cql_user:CHANGE_THIS_STRONG_PASSWORD@postgres:5432/cql_clinic_prod?sslmode=require

# Database Performance Settings
DB_MAX_CONNECTIONS=100
DB_CONNECTION_TIMEOUT=5000
DB_QUERY_TIMEOUT=30000
DB_SSL_CA=
DB_SSL_KEY=
DB_SSL_CERT=

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_HOST=redis
REDIS_PASSWORD=CHANGE_THIS_REDIS_PASSWORD
REDIS_URL=redis://:CHANGE_THIS_REDIS_PASSWORD@redis:6379

# Redis Performance Settings
REDIS_MAX_CONNECTIONS=50
REDIS_CONNECTION_TIMEOUT=5000

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================
# JWT Configuration (CRITICAL: Use strong, unique secrets)
JWT_SECRET=CHANGE_THIS_TO_A_VERY_LONG_AND_RANDOM_STRING_AT_LEAST_64_CHARACTERS_LONG
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d
JWT_ISSUER=cql-clinic
JWT_AUDIENCE=cql-clinic-users

# Session Configuration
SESSION_SECRET=CHANGE_THIS_TO_ANOTHER_VERY_LONG_AND_RANDOM_STRING
SESSION_MAX_AGE=86400000

# CSRF Protection
CSRF_SECRET=CHANGE_THIS_CSRF_SECRET_STRING

# Password Policy
MIN_PASSWORD_LENGTH=8
MAX_LOGIN_ATTEMPTS=5
LOGIN_LOCKOUT_DURATION=1800000

# Two-Factor Authentication
ENABLE_2FA=true
TOTP_ISSUER=CQL Clinic

# Email Verification
REQUIRE_EMAIL_VERIFICATION=true
EMAIL_VERIFICATION_TOKEN_EXPIRY=86400000

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX=100
RATE_LIMIT_REDIS_URL=${REDIS_URL}

# API-specific rate limits
API_RATE_LIMIT_MAX=100
AUTH_RATE_LIMIT_MAX=5
CQL_RATE_LIMIT_MAX=20
PASSWORD_RESET_RATE_LIMIT_MAX=3

# =============================================================================
# CQL RUNNER CONFIGURATION
# =============================================================================
CQL_RUNNER_URL=http://cql-runner:8080
CQL_RUNNER_THREADS=4
CQL_TIMEOUT=30000
MAX_CQL_LENGTH=50000

# Java Runtime Options
JAVA_OPTS=-Xmx2g -Xms512m -XX:+UseG1GC -XX:MaxGCPauseMillis=200

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================
# SMTP Settings
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password

# Email Templates
FROM_EMAIL=noreply@cqlclinic.com
FROM_NAME=CQL Code Clinic
SUPPORT_EMAIL=support@cqlclinic.com

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================
# Let's Encrypt ACME
ACME_EMAIL=admin@cqlclinic.com
LETSENCRYPT_STAGING=false

# SSL Certificate Paths (if using custom certificates)
SSL_CERT_PATH=
SSL_KEY_PATH=
SSL_CA_PATH=

# =============================================================================
# MONITORING AND LOGGING
# =============================================================================
# Log Levels
LOG_LEVEL=info
TRAEFIK_LOG_LEVEL=INFO

# Metrics and Monitoring
ENABLE_METRICS=true
PROMETHEUS_ENABLED=true
GRAFANA_PASSWORD=CHANGE_THIS_GRAFANA_PASSWORD

# Performance Monitoring
PERF_SAMPLE_RATE=1.0
SLOW_REQUEST_MS=2000
SLOW_QUERY_MS=1000

# =============================================================================
# SECURITY MONITORING
# =============================================================================
# Security Alerts
SECURITY_ALERTS_ENABLED=true
SECURITY_WEBHOOK_URL=
SECURITY_EMAIL_ALERTS=true
SLACK_SECURITY_WEBHOOK=

# Threat Detection
ANOMALY_DETECTION=true
SUSPICIOUS_ACTIVITY_THRESHOLD=10
AUTO_BLOCK_SUSPICIOUS_IPS=true

# Trusted IP Ranges (comma-separated)
TRUSTED_IPS=127.0.0.1,::1

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
# Database Backup
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=
BACKUP_S3_REGION=
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=

# File Upload Limits
MAX_FILE_SIZE=5242880
MAX_CONTENT_SIZE=10485760

# =============================================================================
# CDN AND ASSET DELIVERY
# =============================================================================
CDN_URL=
STATIC_ASSETS_URL=
MEDIA_URL=

# Asset Optimization
ENABLE_COMPRESSION=true
ASSET_CACHE_DURATION=86400

# =============================================================================
# THIRD-PARTY INTEGRATIONS
# =============================================================================
# Analytics
GOOGLE_ANALYTICS_ID=
MIXPANEL_TOKEN=

# Error Tracking
SENTRY_DSN=
SENTRY_ENVIRONMENT=production

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_REGISTRATION=true
ENABLE_PASSWORD_RESET=true
ENABLE_SOCIAL_LOGIN=false
ENABLE_API_DOCS=false
ENABLE_ADMIN_PANEL=true

# Maintenance Mode
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=We're currently performing scheduled maintenance. Please check back soon.

# =============================================================================
# SCALING AND PERFORMANCE
# =============================================================================
# Application Scaling
WEB_CONCURRENCY=4
MAX_WORKERS=10
WORKER_TIMEOUT=30000

# Database Connection Pooling
DB_POOL_MIN=5
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT=300000

# Cache Configuration
CACHE_DEFAULT_TTL=3600
CACHE_MAX_SIZE=1000
REDIS_POOL_SIZE=10

# =============================================================================
# DEVELOPMENT OVERRIDES (Leave empty in production)
# =============================================================================
# Only set these in development/staging environments
SKIP_RATE_LIMIT=
MOCK_AUTH=
DISABLE_HTTPS_REDIRECT=
VERBOSE_LOGGING=

# =============================================================================
# HEALTH CHECK ENDPOINTS
# =============================================================================
HEALTH_CHECK_PATH=/health
READY_CHECK_PATH=/ready
METRICS_PATH=/metrics

# Health Check Intervals
HEALTH_CHECK_INTERVAL=30000
HEALTH_CHECK_TIMEOUT=5000
HEALTH_CHECK_RETRIES=3

# =============================================================================
# CORS AND SECURITY HEADERS
# =============================================================================
# Additional CORS settings
CORS_MAX_AGE=86400
CORS_CREDENTIALS=true

# Security Headers
HSTS_MAX_AGE=31536000
CSP_REPORT_URI=
REFERRER_POLICY=strict-origin-when-cross-origin

# =============================================================================
# API VERSIONING
# =============================================================================
API_VERSION=v1
API_DEFAULT_VERSION=v1
API_SUPPORTED_VERSIONS=v1

# =============================================================================
# WEBHOOK CONFIGURATION
# =============================================================================
# Outgoing Webhooks
WEBHOOK_TIMEOUT=5000
WEBHOOK_RETRIES=3
WEBHOOK_SECRET=CHANGE_THIS_WEBHOOK_SECRET

# =============================================================================
# INTERNATIONALIZATION
# =============================================================================
DEFAULT_LOCALE=en
SUPPORTED_LOCALES=en
TIMEZONE=UTC

# =============================================================================
# CONTENT SECURITY
# =============================================================================
# Content Validation
ENABLE_CONTENT_SCANNING=true
MALWARE_SCANNING=false
CONTENT_FILTER_ENABLED=true

# Upload Restrictions
ALLOWED_FILE_TYPES=text/plain,application/json,text/csv
MAX_UPLOAD_SIZE=5242880

# =============================================================================
# DOCUMENTATION
# =============================================================================
# To use this configuration:
# 1. Copy this file to .env.production
# 2. Replace ALL "CHANGE_THIS_*" values with secure, random strings
# 3. Update domain names to match your actual domains
# 4. Configure your database and Redis credentials
# 5. Set up your email SMTP settings
# 6. Configure SSL certificates or Let's Encrypt
# 7. Review and adjust rate limits and timeouts for your needs
# 8. Set up monitoring and alerting webhooks
# 9. Configure backup storage (S3 or similar)
# 10. Test the configuration in a staging environment first

# Security Notes:
# - Use a password manager to generate strong, unique secrets
# - Enable 2FA for all admin accounts
# - Regularly rotate secrets and certificates
# - Monitor security logs and set up alerts
# - Keep all dependencies and Docker images updated
# - Use HTTPS only (never HTTP in production)
# - Implement proper backup and disaster recovery procedures